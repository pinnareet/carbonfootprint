<h1>Home#index</h1>
<p>Find me in app/views/home/index.html.erb</p>
<p>
  <%i = 0%>
  <% @list.each do |line| %>
    <%= i %> <%= line %> </br>
    <% i = i+1 %>
  <% end %>
</p>

<p>
  <%= @list[10] %>
</p>
<div id = 'results'></div>
<script src="http://maps.google.com/maps?file=api&v=2" type="text/javascript"></script>
<!-- According to the Google Maps API Terms of Service you are required display a Google map when using the Google Maps API. see: http://code.google.com/apis/maps/terms.html -->
<script type="text/javascript">
    geocoder = new GClientGeocoder();
    function searchLocation(geocoder, place){
        console.log("entered searchLocation");
        var location;
        geocoder.getLocations(place, function (response){
            if (!response || response.Status.code != 200)
            {
                console.log("Sorry, we were unable to geocode address");
                /*
                 var error1 = document.createElement("DIV")
                 error1.innerHTML = "Unable to geocode the conference address";
             document.getElementById('results').appendChild(error1);
             */

            }
            else
            {
                location = {lat: response.Placemark[0].Point.coordinates[1], lon: response.Placemark[0].Point.coordinates[0], address: response.Placemark[0].address};
            }
        });
        return location;
    }
    function calculateDistance(name, id, location1, location2)
    {
        console.log("entered calculateDistance");
        try
        {
            var glatlng1 = new GLatLng(location1.lat, location1.lon);
            var glatlng2 = new GLatLng(location2.lat, location2.lon);
            var miledistance = glatlng1.distanceFrom(glatlng2, 3959).toFixed(0);
            var kmdistance = (miledistance * 1.609344).toFixed(0);
            var entry = document.createElement("P");
            entry.innerHTML = id + ' ' + name +"'s distance" + '</br>';
            entry.innerHTML += '<strong>Address 1: </strong>' + location1.address + '<br /><strong>Address 2: </strong>' + location2.address +'<br />';
            entry.innerHTML += '<strong>Distance: </strong>' + miledistance + ' miles (or ' + kmdistance + ' kilometers)' + '</br>';
            document.getElementById('results').appendChild(entry);

        }
        catch (error)
        {
            alert(error);
        }
    }
    window.onload = function(){
        <% Conference.all.each do |conference| %>
            var conference_name_<%=conference.id%> = document.createElement("P");
            conference_name_<%=conference.id%>.innerHTML = "<%= conference.name %>";
            document.getElementById('results').appendChild(conference_name_<%=conference.id%>);
            location1 = searchLocation(geocoder, "<%=conference.location %>");
            console.log(location1);
            <% conference.attendees.each do |attendee| %>
                location_<%=attendee.id%> = searchLocation(geocoder, "<%= attendee.location %>");
                if(location1 && location_<%=attendee.id%>){
                    calculateDistance("<%=attendee.name %>", <%= attendee.id %>, location1, location_<%=attendee.id%>);
                }
            <% end %>
        <% end %>
    }
</script>


